# Grinder

Telegram bot for chats administration.

[![Build Status](https://dev.azure.com/GrinderDotNetRu/Grinder/_apis/build/status/Keroosha.grinder?branchName=master)](https://dev.azure.com/GrinderDotNetRu/Grinder/_build/latest?definitionId=1&branchName=master)

## Configuration and build

To build run you have to add a `bot_config.json` file on path `src\Grinder\`

File structure:

```
{
  "Token": ...,
  "ChannelId": ...,
  "AdminUserId": ...,
  "Socks5Proxy": {
    "Hostname": "...",
    "Port": ...,
    "Username": "...",
    "Password": "..."
  },
  "ChatsToMonitor": [
    "chat @username",
    ...
  ],
  "AllowedUsers": [
    "username without at sign",
    ...
  ]
}
```

`Token` - bot api token.

`ChannelId` - telegram channel id where bot whill write command logs.

`AdminUserId` - telegram user id who will be able to send private messages to bot.

`Socks5Proxy` - Socks5 proxy configuration.

`ChatsToMonitor` - chats where bot will read messages and replyes.

`AllowedUsers` - users, who will be able to execute commands in chats from `ChatsToMonitor`

### Build

To build run in docker on Raspberry Pi. From root directory:

```
docker-compose build && docker-compose up -d
```

To build run from coomand line. From `src\Grinder\` directory:

```
dotnet run -c Release
```

## Bot commands

1) Ban
    
    While writing in any chat from `ChatsToMonitor`:

    `@botusername @user1 @user2 ... ban <time>`

    Where time can be combination of this: 

    Days: `<integer> day(s)`

    Minutes: `<integer> min(s)`

    Months: `<integer> month(s)`

    Time fractions can appear in any order and once.

    This will ban user in all chats from `ChatsToMonitor`

    Examples:

    `@botusername @user1 @user2 ... ban 1 month 12 minutes`

    `@botusername @user1 @user2 ... ban 6 minutes`

    `@botusername @user1 @user2 ... ban 1 month 5 minutes`

2) Unban 

    While writing in any chat from `ChatsToMonitor`:

    `@botusername @user1 @user2 ... unban`

    This will unban user in all chats from `ChatsToMonitor`

3) Ban on reply

    While writing a reply to user in `ChatsToMonitor`:

    `@botusername ban`

    This will permaban user in all chats from `ChatsToMonitor`

4) Database update

    This can execute only user `AdminUserId`. 

    This will update a database mapping of usernames to userid's. You have to send a file in a private message to bot.

    File structure:

    ```
    [
      {"UserId": <telegram user id> ,"Username": "username without at sign"},
      ...
    ]
    ```

    File can be generated by running a project `Export tool` on path `src\Grinder.ExportTool\`.
